<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<link rel="shortcut icon" href="./icons/favicon.ico" type="image/x-icon">
	<link rel="icon" type="image/png" href="./icons/icon-16x16.png" sizes="16x16">
	<link rel="icon" type="image/png" href="./icons/icon-32x32.png" sizes="32x32">
	<link rel="icon" type="image/png" href="./icons/icon-96-96.png" sizes="96x96">
	<link rel="icon" type="image/png" href="./icons/android-chrome-192x192.png" sizes="192x192">
	<link rel="apple-touch-icon" sizes="180x180" href="./icons/apple-touch-icon-180x180.png">
	<link rel="manifest" href="manifest.json">


	<title>gpSpeed</title>
</head>
<body>
	<header>
		<div class="headerInner">
			<div class="logo-wrapper">
				<h1 class="logo"><span class="gp">gp</span>Speed</h1>
			</div>
			<div class="globalNav">
				<a href="https://github.com/nPeeech/GPS_speedmeter" target="_blank" rel="noopener noreferrer">Code's here!</a>
			</div>
		</div>
	</header>
	<main>
		<div class="meter-wrapper">
			<div id="meter-pointer"></div>
			<div id="meter-digital">0</div>
			<div class="unit">km/h</div>
			<div id="meter-number-plate"></div>
			<div class="meter-number-wrapper">
				<div class="meter-number" id="meter-number-0">0</div>
				<div class="meter-number" id="meter-number-25">25</div>
				<div class="meter-number" id="meter-number-50">50</div>
				<div class="meter-number" id="meter-number-75">75</div>
				<div class="meter-number" id="meter-number-100">100</div>
				<div class="meter-number" id="meter-number-125">125</div>
				<div class="meter-number" id="meter-number-150">150</div>
				<div class="meter-number" id="meter-number-175">175</div>
			</div>
		</div>
		<div id="install-btn">Install</div>
	</main>
	
<footer>
	<div class="footerInner">
		<small>&copy; 2020 nPeeech</small>
	</div>
</footer>
<script src="script.js"></script>
<script>
	if ('serviceWorker' in navigator) {
		navigator.serviceWorker.register('service_worker.js').then(function(registration) {
			console.log('ServiceWorker registration successful with scope: ', registration.scope);
		}).catch(function(err) {
			console.log('ServiceWorker registration failed: ', err);
		});
	}
</script>
<script>
	//バナーの代わりに表示するボタンを登録する
registerInstallAppEvent(document.getElementById("install-btn"));

//バナー表示をキャンセルし、代わりに表示するDOM要素を登録する関数
//引数１：イベントを登録するHTMLElement
function registerInstallAppEvent(elem){
  //インストールバナー表示条件満足時のイベントを乗っ取る
  window.addEventListener('beforeinstallprompt', function(event){
    console.log("beforeinstallprompt: ", event);
    event.preventDefault(); //バナー表示をキャンセル
    elem.promptEvent = event; //eventを保持しておく
    elem.style.display = "block"; //要素を表示する
    return false;
  });
  //インストールダイアログの表示処理
  function installApp() {
    if(elem.promptEvent){
      elem.promptEvent.prompt(); //ダイアログ表示
      elem.promptEvent.userChoice.then(function(choice){
        elem.style.display = "none";
        elem.promptEvent = null; //一度しか使えないため後始末
      });//end then
    }
  }//end installApp
  //ダイアログ表示を行うイベントを追加
  elem.addEventListener("click", installApp);
}//end registerInstallAppEvent
</script>
</body>
</html>